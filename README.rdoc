= Double Agent

double_agent is a library for parsing browser and operating system info out of user 
agent strings. It is designed for parsing large sets for review or analysis.

== Installation

    gem install double_agent

== Loading

Double Agent is broken up into four components - core, resources, stats, logs

    # Load the default components (core, resources and stats)
    require 'double_agent'

    # Load components individually (some have dependencies on others)
    require 'double_agent/core|resources|stats|logs'

    # Load everything
    require 'double_agent/all'

= The Core Parser

    ua_string = "pretent I'm a user agent string for Chrome on Ubuntu"

    DoubleAgent.browser(ua_string)
    => "Chrome 11"

    DoubleAgent.browser_family(ua_string)
    => "Chromium"

    DoubleAgent.os(ua_string)
    => "Ubuntu"

    DoubleAgent.os_family(ua_string)
    => "GNU/Linux"

See the DoubleAgent module for more.

= Resources

DoubleAgent::Resource is a mix-in for objects with a user_agent method or attribute.
It gives that class's objects all of the above methods.

    class Login
      include DoubleAgent::Resource

      def user_agent
        #returns the user agent string the user logged in with
      end
    end

    login = Login.find(76)

    login.browser
    => "Firefox 4"

    login.os_family
    => "OS X"

= Stats

Calculate browser and OS shares for large sets of DoubleAgent::Resource objects.

    logins = Login.all
    stats = DoubleAgent.percentages_for(logins, :browser_family, :os_family)

    p stats
    => [["Firefox", "Windows", 50.0], ["Internet Explorer", "Windows", 20.0], ["Safari", "OS X", 20.0], ["Firefox", "GNU/Linux", 10.0]]

    stats.each do |browser_family, os_family, percent|
      puts "#{browser_family} on #{os_family} - #{percent}%"
    end

= Logs

DoubleAgent::log_entries parses through Apache and Nginx access logs, instantiating each log line into a DoubleAgent::LogEntry
object. It even reads gzipped logs (requires zlib)! Since the DoubleAgent::LogEntry class mixes in DoubleAgent::Resource, you
can easily calculate browser and/or OS market share on your site.

    require 'double_agent'
    require 'double_agent/logs'

    entries = DoubleAgent.log_entries("/var/log/nginx/my-site.access.log*")
    stats = DoubleAgent.percentages_for(entries, :browser)

    p stats
    => [["Firefox 4", 20.0], ["Internet Explorer 8", 18.0], ...]
