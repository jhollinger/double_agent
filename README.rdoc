= Double Agent

double_agent is a library for parsing browser and operating system info out of user 
agent strings. It is designed for parsing large sets for review or analysis.

*New in 1.0.0* Helpers for generating pretty graphs!! Requires gruff.

*NOTE* Support for Ruby 1.8.x was dropped after version 0.2.3.

== Installation

    gem install double_agent

== Loading

Double Agent is broken up into modules - Parser, Resources, Stats, Logs and Graphs.

    # Load the core modules (Parser, Resources)
    require 'double_agent'

    # Load modules individually
    require 'double_agent/parser|resources|stats|logs|graphs|all'

Read the full documentation at http://jordanhollinger.com/docs/double_agent/

= Parser

    user_agent = DoubleAgent.parse("Mozilla/5.0 (X11; Linux i686) AppleWebKit/535.19 (KHTML, like Gecko) Ubuntu/12.04 Chromium/18.0.1025.168 Chrome/18.0.1025.168 Safari/535.19")

    user_agent.browser
    => "Chrome 18"

    user_agent.browser_family
    => "Chromium"

    user_agent.os
    => "Ubuntu"

    user_agent.os_family
    => "GNU/Linux"

    user_agent.mobile?
    => false

    # Or

    DoubleAgent.browser("Mozilla/5.0 (X11; Linux i686) AppleWebKit/535.19 (KHTML, like Gecko) Ubuntu/12.04 Chromium/18.0.1025.168 Chrome/18.0.1025.168 Safari/535.19")
    => "Chrome 18"

See the DoubleAgent module for more.

= Resources

DoubleAgent::Resource is a mix-in for objects with a user_agent method.
It gives that class's objects all of the above methods and more.

    class Login
      include DoubleAgent::Resource

      def user_agent
        #returns the user agent string the user logged in with
      end
    end

    login = Login.find(76)

    login.browser
    => "Firefox 4"

    login.os_family
    => "OS X"

= Stats

Calculate browser and OS shares for large sets of DoubleAgent::Resource objects with DoubleAgent::Stats::percentages_for.

    require 'tablizer'

    logins = Login.all
    p logins.size
    => 1000

    stats = DoubleAgent::Stats.percentages_for(logins, :browser_family, :os_family)
    p stats
    => [["Firefox", "Windows", 50.0, 500], ["Internet Explorer", "Windows", 20.0, 200], ["Safari", "OS X", 20.0, 200], ["Firefox", "GNU/Linux", 10.0, 100]]

    puts Tablizer::Table.new(stats)
    => +-----------------+------------+----+---+
       |Firefox          |Windows     |50.0|500|
       |Internet Explorer|Windows     |20.0|200|
       |Safari           |OS X        |20.0|200|
       |Firefox          |GNU/Linux   |10.0|100|
       +-----------------+------------+----+---+

= Logs

DoubleAgent::Logs::entries parses through Apache and Nginx access logs, instantiating each log line into a DoubleAgent::Logs::Entry
object. It even reads gzipped logs (requires zlib)! Since the DoubleAgent::Logs::Entry class mixes in DoubleAgent::Resource, you
can easily calculate browser and/or OS share on your site.

    entries = DoubleAgent::Logs.entries("/var/log/nginx/my-site.access.log*")
    stats = DoubleAgent::Stats.percentages_for(entries, :browser)

    p stats
    => [["Firefox 4", 20.0, 650], ["Internet Explorer 8", 18.0, 587], ...]

Check out the DoubleAgent::Logs::Entry class for more methods besides user_agent.

= Graphs

DoubleAgent::Graphs offers several helpers for generating gruff graphs. Here's an example pie chart, using DoubleAgent::Logs as a data source. However, any object that includes DoubleAgent::Resource can be used.

    log_entries = DoubleAgent::Logs.entries("/var/log/nginx/my-site.access.log*")

    DoubleAgent::Graphs.pie(log_entries, :browser_family, '/path/to/browser-share.png', 'Browser Share')

Look at DoubleAgent::Graphs for more graphs and lots more examples.

== License
Copyright 2011 Jordan Hollinger

Licensed under the Apache License
